<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>שירת העשבים</title>
</head>
<body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
    <!-- https://cdnjs.com/libraries/FileSaver.js -->
    <!-- https://github.com/eligrey/FileSaver.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        var dict = {
            111111111: "1",
            216508770: "2",
            333333333: "3",
            444444444: "4",
            555555555: "5",
            666666666: "6",
		    777777777: "7",
            888888888: "8"
        };
		var points={
		"1":300,
		"2":500,
		"3":300,
		"4":200,
		"5":700,
		"6":100,
		"7":100,
		"8":100
		}
        var counter = 0;
        var status = 0;
        var fullName;
		var lock;
        var points;
		var sumPoints={}
        var sum=0
       var numtask
	   
        function updateTask() {
            counter = 0;
            status = 0;
            lock=1;
            numtask = dict[document.getElementById("barcode").value];
			if(numtask==null)
			{
			alert("מספר משימה לא תקין, גשי למורה!")
			reset();
			status=0;
			return;
			}
			document.getElementById("barcode").value = "";

            if (localStorage.getItem(numtask) == null) {
                localStorage.setItem(numtask, "");
            }
            var item = localStorage.getItem(numtask);
			result = item.includes(fullName);
			if(result!=null)
			{
			alert("הי, אסור להגיש משימה פעמיים!");
			reset();
			status=0;
			return;
			}
            localStorage.setItem(numtask, item + fullName + ",");
			save()
            document.getElementById("line1").innerHTML = "!כל הכבוד "+"ביצעת את משימה"+ " "+ numtask;
            document.getElementById("line2").innerHTML = "מיד תועברי להדפסת אישור";
            document.getElementById("btn").style.backgroundImage = 'url(like.gif)';
            document.getElementById("btn").style.backgroundSize = "300px"
            document.getElementById("btn").style.width = "300px"
            document.getElementById("btn").style.height = "270px"
			var divName="printableArea";
			setTimeout(function(){
    document.getElementById("d1").innerHTML="      התלמידה"+" "+ fullName
    document.getElementById("d2").innerHTML="     ביצעה את משימה"+" "+ numtask;
	document.getElementById("d3").innerHTML="     סך הנקודות הכללי"+" :"+ sum;
	
	document.getElementById("d3").innerHTML="     סך הנקודות הכללי"+" :"+ sum;
	document.getElementById("d3").innerHTML="     סך הנקודות הכללי"+" :"+ sum;


     var printContents = document.getElementById(divName).innerHTML;
     var originalContents = document.body.innerHTML;

     document.body.innerHTML = printContents;

     window.print();

     document.body.innerHTML = originalContents;
	 document.getElementById("reset").style.visibility = "visible";
	 document.getElementById("line1").innerHTML = "!עד כה צברת "+sum+" נקודות ";
     document.getElementById("line2").innerHTML = "...אל תשכחי לקחת את האישור מהמדפסת";
}, 4000);
		
			
			
}	
      function searchInExcel() {
            counter = 0;
            status = 1;
            var searchVal = document.getElementById("barcode").value;
            document.getElementById("barcode").value = "";
            const myObj = JSON.parse(localStorage.getItem("students"));
			if(myObj==null)
			{
			alert("לא הוזנו נתוני תלמידות, פני למורה!")
			reset();
			status=0;
			return;
			}
            var results;
            var searchField = "tz";
            for (var i = 0; i < myObj.length; i++) {
                if (myObj[i][searchField] == searchVal) {
                    results = myObj[i];
                }
            }
			if(results==null)
			{
			alert("את לא מופיעה ברשימות, גשי למורה !")
			reset();
			status=0;
			return;
			}
            fullName = results.first + "  " + results.last;
            document.getElementById("line1").innerHTML = "(: שלום  " + fullName;
            document.getElementById("line2").innerHTML = "  עליך לסרוק את הברקוד של המשימה";

        }
       
        document.addEventListener("keypress", function (e) {
            if (e.target.tagName !== "INPUT") {
                var input = document.querySelector(".my-input");
                input.focus();
                input.value = e.key;
                e.preventDefault();
            }
                counter += 1;

            if (counter > 9 && lock !=1) {
                if (status == 0)
                    searchInExcel();
                else
                    updateTask();
            }
			if(lock==1)
			  document.getElementById("barcode").value = "";


        });

        function reset() {
            document.getElementById("reset").style.visibility = "hidden";
            document.getElementById("line1").innerHTML = "ברוכה הבאה ";
            document.getElementById("line2").innerHTML = "העבירי את הכרטיס האישי שלך בסורק הברקוד";
            document.getElementById("btn").style.backgroundImage = 'url(barcode.gif)';
            document.getElementById("btn").style.width = "400px"
            document.getElementById("btn").style.height = "350px"

            document.getElementById("btn").style.backgroundSize = "400px";
			document.getElementById("barcode").value = "";
            lock=0;
			counter=0;
			

        }
        
        function save()
		{
		  if (localStorage.getItem("sumPoints") == null) 
                localStorage.setItem("sumPoints","{}");
        sumPoints = JSON.parse(localStorage.getItem("sumPoints"));
		if(sumPoints[fullName]==null)
		sumPoints[fullName]=0;
        sum=parseInt(points[numtask])+sumPoints[fullName]
		sumPoints[fullName] =sum;
        localStorage.setItem("sumPoints", JSON.stringify(sumPoints));
        sumPoints = JSON.parse(localStorage.getItem("sumPoints"));

}

    </script>
	
<div id="printableArea" style="width:1px; height:1px;color:transparent">
    <span  style="font-size:60px; font-family: Fb Magnolia;z-index: -1;">               אישור     </span>
		   </br>
				</br>
				</br>
				</br>
	    <div id="d1" style="font-size:30px; font-family: Fb Magnolia;font-weight:100"> </div>
	    <div id="d2" style="font-size:30px; font-family: Fb Magnolia;font-weight:100"> </div>
	    <div id="d3" style="font-size:30px; font-family: Fb Magnolia;font-weight:100"> </div>
		</br></br>
				</br>
				</br>

		    <div  id="d4" style="font-size:60px; font-family: Fb Magnolia;">  בהצלחה בהמשך</div>


</div>
    <section id="sec1" style="background-image: url('background.jpg');  z-index: -1; position: absolute;background-size:100%; width: 1350px; height: 750px;"></section>

    <section style="
        width: 1200px;
        height: 650px;
        background-color: #ffffff;
        opacity: 0.4;
        filter: alpha(opacity=40);
        float: left;
        margin-left: 60px;
        margin-top: 50px">
        <p style="color: black; text-align:center;font-size:50px;font-weight:400" id="line1">ברוכה הבאה</p>
        <p style="color: black;text-align: center;font-size: 30px;font-weight: 300" ; id="line2">העבירי את הכרטיס האישי שלך בסורק הברקוד</p>
        <button disabled id="btn"
                style="
        width: 400px;
        height: 350px;
        background-color: transparent;
        background-image: url(barcode.gif);
        background-size: 400px;
        margin-left: 400px;
		border-color:transparent
    "></button>
        <button disabled id="btn" style="        
    width: 400px;
        height: 300px;
        background-color: transparent;
		background-image: url(logo.gif);
        background-size: 800px;
        background-position: center;
        float: right;
        margin-top: 200px;
        border-color:transparent
        /*margin-right:40px**/ /*/

        "></button>
        <button onclick="reset()" id="reset" 
        style="        
	    background-image: url(reset.gif);
		float:left;
        width: 200px;
        height: 100px;
        background-size: 200px;
        background-color: transparent;
        visibility: hidden;
		margin-top: 90px;
		margin-left:10px;
		border:none;

"></button>
    </section>



    <input type="text" class="my-input" id="barcode" style="background-color:transparent;border-color:transparent; float:left">
    

    
    <style>
	
        section {
            font-family: Fb Magnolia;
            font-style: normal;
            font-variant: normal;
            line-height: 26.4px;
        }
    </style>

   
</body>
</html>



