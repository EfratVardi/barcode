<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>הגדרות המערכת</title>
</head>
<body onload="onload()">
    <link href="SystemStyleSheet.css" rel="stylesheet" />
    <link href="MainStyleSheet.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="xlsx.full.min.js"></script>


    <script>
        function onload() {
            if (localStorage.getItem("title"))
                document.getElementById("title").value = localStorage.getItem("title")
            if (localStorage.getItem("date"))
                document.getElementById("date").value = localStorage.getItem("date")
            files="stu.xlxs"
        }

        var json_object;
        var ExcelToJSON = function () {
            this.parseExcel = function (file) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var data = e.target.result;
                    var workbook = XLSX.read(data, {
                        type: 'binary'
                    });
                    workbook.SheetNames.forEach(function (sheetName) {
                        var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                        json_object = JSON.stringify(XL_row_object);
                        if (file.name.startsWith("students")) {
                            if (localStorage.getItem("students") == null) {
                                localStorage.setItem("students", "");
                            }
                            localStorage["students"] = json_object;
                        }
                        else if (file.name.startsWith("tasks")) {
                            if (localStorage.getItem("tasks") == null) {
                                localStorage.setItem("tasks", "");
                            }
                            localStorage["tasks"] = json_object;
                        }
                        else if (file.name.startsWith("uniqTasks")) {
                            if (localStorage.getItem("uniqTasks") == null) {
                                localStorage.setItem("uniqTasks", "");
                            }
                            localStorage["uniqTasks"] = json_object;
                        }
                    })
                };
                reader.onerror = function (ex) {
                    console.log(ex);
                };
                reader.readAsBinaryString(file);
            };
        };

        function handleFileSelect(evt) {
            var files = evt.target.files;
            var xl2json = new ExcelToJSON();
            xl2json.parseExcel(files[0]);
        }

        function updateTitle(evt) {
            if (localStorage.getItem("title") == null) {
                localStorage.setItem("title", "");
            }
            localStorage["title"] = document.getElementById("title").value;
        }

        function updateDate(evt) {
            if (localStorage.getItem("date") == null) {
                localStorage.setItem("date", "");
            }
            localStorage["date"] = document.getElementById("date").value;
        }
    </script>

    <div class="background1">
        <div class="background2">
            <div class="text">
                <div id="line1">הגדרות המערכת</div>
                <img src="up.gif" class="gif" id="gif" />
            </div>
            <div>
                <div><label style="font-size: 13px;">תלמידות</label><input id="uploadStudents" type=file name="files[]"></div>
                <label style="font-size: 13px;">משימות</label><input id="uploadTasks" type=file name="files[]">
                <label style="font-size: 13px;">משימות אישיות</label><input id="uploaduniqTasks" type=file name="files[]">
                <label style="font-size: 13px;">עדכון כותרת</label><input type="text" id="title"><button onclick="updateTitle()">עדכן</button>
                <label style="font-size: 13px;">תאריך אחרון</label><input type="date" id="date"><button onclick="updateDate()">עדכן</button>

            </div>
        </div>
    </div>


    <script>
        document.getElementById('uploadStudents').addEventListener('change', handleFileSelect, false);
        document.getElementById('uploadTasks').addEventListener('change', handleFileSelect, false);
        document.getElementById('uploaduniqTasks').addEventListener('change', handleFileSelect, false);
    </script>
</body>
</html>
